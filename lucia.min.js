var Lucia=function(){"use strict";const t="l-";var e;!function(t){t["@"]="on",t[":"]="bind"}(e||(e={}));const s=t=>t.replace(/\s+/gim," ").trim();var n;!function(t){t[t.NULL=-1]="NULL",t[t.STATIC=0]="STATIC",t[t.DYNAMIC=1]="DYNAMIC"}(n||(n={}));const o=t=>new RegExp(`\\b${t}\\b`,"gim"),r=(t,e)=>t[e],i=(t,e,s)=>{t[e]=s},c=t=>[...new Set(t)],l=(t,e,s=!0,n={})=>{const o=`with($state){${s?`return ${t}`:t}}`;return(s,r)=>{try{const i=s[t];if(i)return"function"==typeof i?s[t]():i;{const t={$state:s,$el:e,$emit:(t,s,n=!0)=>{const o=new CustomEvent(t,s);(n?window:e||window).dispatchEvent(o)},$event:r,$refs:n};return new Function(...Object.keys(t),o)(...Object.values(t))}}catch(s){console.warn(`Lucia Error: "${s}"\n\nExpression: "${t}"\nElement:`,e)}}},a=t=>t.hasAttribute("l-for"),u=(t,e)=>{const[s,r]=d(t,e),i=Object.keys(s).length>0,c=Object.values(s).some((({value:t})=>Object.keys(e).some((e=>o(e).test(t)))))?n.DYNAMIC:n.STATIC;return i?{el:t,deps:r,directives:s,type:c}:void 0},d=(s,n={})=>{const a={},u=(()=>{const t=document.querySelectorAll("[l-ref]"),e={};for(const s of t){const t=s.getAttribute("l-ref");t&&(e[t]=s)}return e})(),d=[];for(const{name:f,value:p}of s.attributes){const h="l-state"===f,m=f.startsWith(t),v=Object.keys(e).some((t=>f.startsWith(t)));if(h||!m&&!v)continue;const b=[],y=Object.keys(n);let g=!0;const A=y.filter((t=>{const e=o(t).test(String(p));if(e&&"function"==typeof n[t]){const e=y.filter((e=>o(e).test(String(n[t]))));b.push(...e)}return e}));/on|@/gim.test(f)&&(g=!1),f.includes("for")&&void 0===r(s,"__for_template")&&(i(s,"__for_template",String(s.innerHTML).trim()),g=!1);const $=c([...A,...b]);d.push(...$);const _={compute:l(p,s,g,u),deps:$,value:p};a[(m?f.slice(t.length):`${e[f[0]]}:${f.slice(1)}`).toLowerCase()]=_}return[a,c(d)]},f=(t,e=!1,s=!1)=>{const n=[],o=a(t),r=!!(i=t).parentElement&&i.parentElement.hasAttribute("l-for");var i;if(!e&&(o||r))return n;if(s||e&&o||n.push(t),e||!o&&!r)for(const s of t.childNodes)if(s.nodeType===Node.ELEMENT_NODE)if(!e&&a(s))n.push(s);else{if(s.hasAttribute("l-state"))continue;n.push(...f(s,e))}return n},p=(t,s={},n=!1)=>{const o=[],i=void 0!==r(t,"component")&&a(t),c=f(t,i,n),l="l-mask";for(const t of c)if(t.hasAttribute(l)&&t.removeAttribute(l),new RegExp(`(l-|${Object.keys(e).join("|")})\\w+`,"gim").test(t.outerHTML)){const e=u(t,s);e&&o.push(e)}return o},h=(t,e,s={},o=[])=>{"string"==typeof o&&(o=[o]);const r=Object.keys(e);for(let i=0;i<t.length;i++){const c=t[i];if(c.type===n.NULL)continue;const l=c.type===n.STATIC;l&&(c.type=n.NULL);if(o.some((t=>c.deps.includes(t)))||l)for(const[t,n]of Object.entries(c.directives)){const i=t.split(/:|\./)[0];if(!r.includes(i.toUpperCase()))continue;const a=o.some((t=>n.deps.includes(t))),u="l-mask"===t,d=0===Object.keys(n.deps).length;if(a||l||d){const o={el:c.el,parts:t.split(/:|\./gim),data:n,node:c,state:s};b(o,e),(d||u)&&(delete c.directives[t],u&&c.el.removeAttribute("l-mask"))}}}},m=(t,e,s,n)=>{const o=[];for(const e of t)o.push(...e.deps);const r=c([...e,...o]);s.deps=r,s.directives[n].deps=r},v={BIND:({el:t,parts:e,data:n,state:o})=>{switch(e[1]){case"class":const r=n.compute(o);if("string"==typeof r)return t.setAttribute("class",s(`${t.className} ${r}`));if(r instanceof Array)return t.setAttribute("class",s(`${t.className} ${r.join(" ")}`));{const e=[];for(const t in r)r[t]&&e.push(t);const n=new RegExp(`\\b${Object.keys(r).join("|")}\\b`,"gim"),o=t.className.replace(n,"");if(e.length>0)return t.setAttribute("class",s(`${o} ${e.join(" ")}`));if(s(o).length>0)return t.setAttribute("class",s(o));if(t.hasAttribute("class"))return t.removeAttribute("class")}break;case"style":const i=n.compute(o);t.removeAttribute("style");for(const e in i)t.style[e]=i[e];break;default:const c=n.compute(o);if("object"==typeof c&&null!==c)for(const e in c)c[e]?t.setAttribute(e,c[e]):t.removeAttribute(e);else c?t.setAttribute(e[1],c):t.removeAttribute(e[1])}},HTML:({el:t,data:e,state:s,node:n})=>{var o;n=n;const c=r(t,"component");t.innerHTML=null!==(o=e.compute(s))&&void 0!==o?o:e.value;const l=p(t,s,!0);c||m(l,e.deps,n,"html"),h(l,v,s,e.deps),i(t,"component",!0)},MODEL:({el:t,parts:e,data:s,state:n})=>{const o=t,c=n[s.value],l="checkbox"===o.type?"checked":"value";if(o[l]!==String(c)&&(o[l]=c),!r(o,"__model_registered")){const t=()=>((t,e,s,n)=>{"checkbox"===t.type&&(t.value=String(t.checked));const o="number"==typeof e&&!isNaN(t.value),r="boolean"==typeof e&&("true"===t.value||"false"===t.value),i=null==e&&("null"===t.value||"undefined"===t.value);let c;return c=o?parseFloat(t.value):r?"true"===t.value:i?"null"===t.value?null:void 0:String(t.value),n[s.value]=c,c})(o,c,s,n);o.addEventListener("debounce"===e[1]?"change":"input",t),i(o,"__model_registered",!0)}},SHOW:({el:t,data:e,state:s})=>{t.style.display=e.compute(s)?"":"none",0===t.style.length&&t.removeAttribute("style")},ON:({el:t,parts:e,data:s,state:n})=>{const o={},c=e.slice(2);if(r(t,`__on_${e[1]}_registered`))return;const l=["outside","global"].some((t=>String(c).includes(t)))?window:t;o.once=c.includes("once"),o.passive=c.includes("passive"),l.addEventListener(e[1],(e=>{if(e instanceof KeyboardEvent&&/\d/gim.test(String(c))){const t=[];for(const e of c)isNaN(e)||t.push(Number(e));if(!t.includes(e.keyCode))return}if(c.includes("prevent")&&e.preventDefault(),c.includes("stop")&&e.stopPropagation(),!c.includes("self")||e.target===t){if(c.includes("outside")){if(t.contains(e.target))return;if(t.offsetWidth<1&&t.offsetHeight<1)return}s.compute(n,e)}}),o),i(t,`__on_${e[1]}_registered`,!0)},TEXT:({el:t,data:e,state:s})=>{var n;t.textContent=null!==(n=e.compute(s))&&void 0!==n?n:e.value},FOR:({el:t,data:e,state:s,node:n})=>{var c;n=n;const a=r(t,"component");i(t,"component",!0);const[u,d]=e.value.split(/\s+(?:in|of)\s+/gim),[f,b]=null==u?void 0:u.trim().replace(/\(|\)/gim,"").split(","),y=null!==(c=s[null==d?void 0:d.trim()])&&void 0!==c?c:l(null==d?void 0:d.trim(),t,!0)(s),g=p(t,s);let A=r(t,"__for_template");t.innerHTML.trim()===A&&(t.innerHTML="");const $=(null==y?void 0:y.length)-t.children.length;if(0===(null==y?void 0:y.length))t.innerHTML="";else if(0!==$)for(let e=Math.abs($);e>0;e--)if($<0)t.removeChild(t.lastChild);else{const s=A.startsWith("<th")?"thead":A.startsWith("<td")||A.startsWith("<tr")?"tbody":"div",n=document.createElement(s);let r=A;f&&(r=r.replace(o(`this\\.${f.trim()}`),`${d}[${y.length-e}]`)),b&&(r=r.replace(o(`this\\.${b.trim()}`),String(y.length-e))),n.innerHTML=r,t.appendChild(n.firstElementChild)}a||(m(g,e.deps,n,"for"),t.removeAttribute("l-for")),h(p(t,s),v,s,n.deps)}},b=(t,e)=>{e[t.parts[0].toUpperCase()](t)},y=(t,e,s={})=>{const n={get:(t,e)=>"object"==typeof t[e]&&null!==t[e]?new Proxy(t[e],n):t[e],set(n,o,r){if("function"==typeof t[o])return!1;const i=!isNaN(Number(o))||"length"===o;let c=[o];n instanceof Array&&i?c=Object.keys(t).filter((e=>{return s=t[e],o=n,s instanceof Array&&o instanceof Array&&s.length===o.length&&s.every(((t,e)=>t===o[e]));var s,o})):Object.keys(t).some((t=>void 0===n[t]))&&(c=Object.keys(t).filter((e=>"object"==typeof t[e]))),n[o]=r,e(c);for(const[t,e]of Object.entries(s))c.includes(t)&&e();return!0}};return new Proxy(Object.seal(t),n)};class g{constructor(t={},e={},s={}){this.state=t,this.directives=e,this.watchers=s}mount(t){const e="string"==typeof t?document.querySelector(t):t;return this.ast=p(e,this.state),this.directives={...this.directives,...v},this.state=y({...this.state,$render:(t=Object.keys(this.state))=>this.render(t)},this.render.bind(this),this.watchers),this.render(),i(e,"component",this),this.state}directive(t,e){this.directives[t.toUpperCase()]=e}watch(t,e){this.watchers[t]=e}render(t=Object.keys(this.state)){h(this.ast,v,this.state,t)}}const A=t=>new g(t),$=(t=document)=>{const e="l-state",s=[...t.querySelectorAll("[l-state]")].filter((t=>void 0===r(t,"component")));for(const t of s){const s=t.getAttribute(e),n=l(`${s||"{}"}`,t,!0)({});A(n).mount(t)}};var _=Object.freeze({__proto__:null,component:A,compile:p,render:h,reactive:y,directives:v,computeExpression:l,init:$});return"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",(()=>{const t=window.customLuciaInit;t?t($):$()})),_}();
